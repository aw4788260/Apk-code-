name: ğŸš€ 1-Click Auto Release

on:
  workflow_dispatch: # Ø§Ù„Ø²Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠ (Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø®Ø§Ù†Ø§Øª Ø¥Ø¯Ø®Ø§Ù„)

jobs:
  build_and_release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v3
        with:
          cache-disabled: true 
          gradle-version: '8.2' 

      # --- 1. ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ù…Ù„ÙØ§Øª (Ù†ÙØ³ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©) ---
      - name: Create google-services.json
        env:
          DATA: ${{ secrets.GOOGLE_SERVICES_JSON_B64 }}
        run: |
          echo $DATA | base64 -d > app/google-services.json

      - name: Decode Keystore
        env:
          KEYSTORE_DATA: ${{ secrets.APP_KEYSTORE_BASE64 }}
        run: |
          echo $KEYSTORE_DATA | base64 -d > app/my-upload-key.jks

      # --- 2. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹Ø© (Ù…Ø¹ ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ) ---
      - name: Build Release APK
        env:
          KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
          KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
          BUILD_NUMBER: ${{ github.run_number }} # Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ÙŠØ²ÙŠØ¯ ÙˆØ­Ø¯Ù‡ (318, 319...)
        run: gradle :app:assembleRelease

      # --- 3. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥ØµØ¯Ø§Ø± ÙˆØ±ÙØ¹ Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ---
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        if: success()
        with:
          # Ø³ÙŠØªÙ… ØªØ³Ù…ÙŠØ© Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø§Ø¡ (Ù…Ø«Ù„Ø§Ù‹ v318)
          tag_name: v${{ github.run_number }}
          # Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø³ÙŠÙƒÙˆÙ† "ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… 318"
          name: ğŸš€ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø±Ù‚Ù… ${{ github.run_number }}
          # ÙˆØµÙ Ø§Ù„Ø¥ØµØ¯Ø§Ø±
          body: |
            ØªÙ… Ø¨Ù†Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
            - **Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø§Ø¡:** ${{ github.run_number }}
            - **Ø§Ù„ØªØ§Ø±ÙŠØ®:** ${{ steps.date.outputs.date }}
            - **Ø§Ù„Ø­Ø§Ù„Ø©:** Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ«Ø¨ÙŠØª âœ…
          files: app/build/outputs/apk/release/app-release.apk
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
